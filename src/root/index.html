<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Redirecting...</title>
    <script>
        const LANG_PREF_KEY = 'languagePreference';
        const AVAILABLE_LANGUAGES = ['en', 'sv', 'no'];

        // This is used only for the initial visit to determine default language
        const DOMAIN_DEFAULTS = {
            'com': 'en',
            'se': 'sv',
            'no': 'no'
        };

        function getDefaultLanguageForDomain() {
            const hostname = window.location.hostname;
            const domainExt = hostname.split('.').pop();

            return DOMAIN_DEFAULTS[domainExt] || 'en';
        }

        function getStoredLanguagePreference() {
            return localStorage.getItem(LANG_PREF_KEY);
        }

        function getRedirectPath() {
            // Get the domain's default language
            const domainDefaultLang = getDefaultLanguageForDomain();

            // Get the user's stored preference (if any)
            const storedPref = getStoredLanguagePreference();

            // Create the base URL
            let redirectUrl = '/home/?lang=' + domainDefaultLang;

            // If we have a stored preference and it's different from the domain default,
            // add the respectLangPref parameter so the language manager can handle it
            if (storedPref && storedPref !== domainDefaultLang) {
                redirectUrl += '&respectLangPref';
            }

            return redirectUrl;
        }

        // Redirect to appropriate language version
        window.location.href = getRedirectPath();
    </script>
    <!-- Fallback meta redirect if JavaScript is disabled -->
    <meta http-equiv="refresh" content="0;url=/home/?lang=en" />
</head>
<body>
<p>Redirecting to appropriate language version...</p>
</body>
</html>